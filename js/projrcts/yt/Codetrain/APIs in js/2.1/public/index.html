<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/p5@1.5.0/lib/p5.min.js"></script>
    <title>Document</title>
</head>
<body>
    <h1>Data selfie app</h1>
    <p><a href="index.html">main</a>|<a href="all.html">data</a></p>
    <p>
    latitude: <span id="lan"></span>&deg;<br>
    longitude: <span id="lon"></span>&deg;
    </p>
    <input id="inputfelt"></input>
    <button id="b" onclick="upload_to_server()" >teext</butto>

    <script>
    function setup(){
        noCanvas();
        capture = createCapture(VIDEO);
        capture.size(240, 240);
    }




        function getIn(){
            const value = document.getElementById("inputfelt").value
            return value;
        }
        function upload_to_server(){
            console.log("uploding...")
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(async geolocation =>{
                    console.log(geolocation);
                const lat = geolocation.coords.latitude
                const lon = geolocation.coords.longitude
                document.getElementById("lan").innerHTML = lat;
                document.getElementById("lon").innerHTML = lon;
                capture.loadPixels();
                console.log(capture)
                const image64 = capture.canvas.toDataURL();
                const data = { lat , lon, input: getIn() ,image64}
                const options = {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }
                const res = await fetch("/api", options)
                const json = await res.json()
                console.log(json)
                console.log("done!")
            });
            } else {
            console.log("The browser does not support geolocation")
            }
        }
   
    
    
    </script>
</body>
</html>